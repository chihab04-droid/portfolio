<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Site Industriel</title>
    <!-- TailwindCSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Styles personnalisés inspirés de l'image */
        .gradient-bg {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
        }
        
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .status-ouvert { background-color: #fef3c7; color: #92400e; }
        .status-en-cours { background-color: #dbeafe; color: #1e40af; }
        .status-resolu { background-color: #d1fae5; color: #065f46; }
        
        .priority-haute { border-left: 4px solid #ef4444; }
        .priority-moyenne { border-left: 4px solid #f59e0b; }
        .priority-basse { border-left: 4px solid #10b981; }
        
        .risk-high { background-color: #fee2e2; border-color: #ef4444; }
        .risk-medium { background-color: #fef3c7; border-color: #f59e0b; }
        .risk-low { background-color: #d1fae5; border-color: #10b981; }
        
        .hidden { display: none !important; }
        
        /* Styles pour les graphiques */
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        /* Styles pour la carte des risques */
        .risk-map {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .risk-zone {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .risk-zone:hover {
            transform: scale(1.05);
        }
        
        /* Timeline styles */
        .timeline-item {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: -20px;
            width: 2px;
            background: #e5e7eb;
        }
        
        .timeline-item:last-child::before {
            display: none;
        }
        
        .timeline-dot {
            position: absolute;
            left: 4px;
            top: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #3b82f6;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #3b82f6;
        }
        
        /* Kanban styles */
        .kanban-column {
            min-height: 400px;
            background: #f8fafc;
            border-radius: 8px;
            padding: 16px;
        }
        
        .kanban-card {
            background: white;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            cursor: move;
            transition: all 0.2s ease;
        }
        
        .kanban-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .risk-map {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation Bar -->
    <nav class="gradient-bg text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo/Titre -->
                <div class="flex items-center">
                    <i class="fas fa-industry text-2xl mr-3"></i>
                    <h1 class="text-xl font-bold">Gestion Site Industriel</h1>
                </div>
                
                <!-- Menu Desktop -->
                <div class="hidden md:flex space-x-8">
                    <button onclick="showPage('maintenance')" class="nav-link hover:text-blue-200 transition-colors duration-200 px-3 py-2 rounded-md">
                        <i class="fas fa-tools mr-2"></i>Maintenance
                    </button>
                    <button onclick="showPage('energie')" class="nav-link hover:text-blue-200 transition-colors duration-200 px-3 py-2 rounded-md">
                        <i class="fas fa-bolt mr-2"></i>Énergie
                    </button>
                    <button onclick="showPage('risques')" class="nav-link hover:text-blue-200 transition-colors duration-200 px-3 py-2 rounded-md">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Lieux à risques
                    </button>
                    <button onclick="showPage('reduction')" class="nav-link hover:text-blue-200 transition-colors duration-200 px-3 py-2 rounded-md">
                        <i class="fas fa-leaf mr-2"></i>Réduction conso
                    </button>
                </div>
                
                <!-- Menu Mobile -->
                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()" class="text-white hover:text-blue-200">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- Menu Mobile Dropdown -->
            <div id="mobile-menu" class="hidden md:hidden pb-4">
                <button onclick="showPage('maintenance')" class="block w-full text-left px-3 py-2 hover:bg-blue-700 rounded-md">
                    <i class="fas fa-tools mr-2"></i>Maintenance
                </button>
                <button onclick="showPage('energie')" class="block w-full text-left px-3 py-2 hover:bg-blue-700 rounded-md">
                    <i class="fas fa-bolt mr-2"></i>Énergie
                </button>
                <button onclick="showPage('risques')" class="block w-full text-left px-3 py-2 hover:bg-blue-700 rounded-md">
                    <i class="fas fa-exclamation-triangle mr-2"></i>Lieux à risques
                </button>
                <button onclick="showPage('reduction')" class="block w-full text-left px-3 py-2 hover:bg-blue-700 rounded-md">
                    <i class="fas fa-leaf mr-2"></i>Réduction conso
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenu Principal -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Page Maintenance -->
        <div id="maintenance-page" class="page-content">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-gray-900">
                    <i class="fas fa-tools text-blue-600 mr-3"></i>Maintenance
                </h2>
                <button onclick="showMaintenanceForm()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                    <i class="fas fa-plus mr-2"></i>Nouvelle Demande
                </button>
            </div>
            
            <!-- Formulaire de création de demande -->
            <div id="maintenance-form" class="hidden bg-white p-6 rounded-lg card-shadow mb-8">
                <h3 class="text-xl font-semibold mb-4">Créer une demande de maintenance</h3>
                <form onsubmit="addMaintenanceRequest(event)">
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Site/Zone</label>
                            <select id="maintenance-site" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Sélectionner...</option>
                                <option value="Atelier A">Atelier A</option>
                                <option value="Atelier B">Atelier B</option>
                                <option value="Bureau">Bureau</option>
                                <option value="Entrepôt">Entrepôt</option>
                                <option value="Parking">Parking</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Équipement</label>
                            <input type="text" id="maintenance-equipement" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description du problème</label>
                        <textarea id="maintenance-description" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Urgence</label>
                            <select id="maintenance-urgence" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Sélectionner...</option>
                                <option value="basse">Basse</option>
                                <option value="moyenne">Moyenne</option>
                                <option value="haute">Haute</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Photo (simulée)</label>
                            <input type="file" id="maintenance-photo" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-save mr-2"></i>Créer la demande
                        </button>
                        <button type="button" onclick="hideMaintenanceForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-times mr-2"></i>Annuler
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Vue Kanban des demandes -->
            <div class="grid md:grid-cols-3 gap-6">
                <div class="kanban-column">
                    <h3 class="text-lg font-semibold mb-4 text-yellow-700">
                        <i class="fas fa-clock mr-2"></i>Ouvert
                    </h3>
                    <div id="kanban-ouvert">
                        <!-- Les cartes seront ajoutées ici dynamiquement -->
                    </div>
                </div>
                <div class="kanban-column">
                    <h3 class="text-lg font-semibold mb-4 text-blue-700">
                        <i class="fas fa-cog mr-2"></i>En cours
                    </h3>
                    <div id="kanban-en-cours">
                        <!-- Les cartes seront ajoutées ici dynamiquement -->
                    </div>
                </div>
                <div class="kanban-column">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">
                        <i class="fas fa-check mr-2"></i>Résolu
                    </h3>
                    <div id="kanban-resolu">
                        <!-- Les cartes seront ajoutées ici dynamiquement -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Énergie -->
        <div id="energie-page" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">
                    <i class="fas fa-bolt text-yellow-500 mr-3"></i>Optimisation Énergétique
                </h2>
                <p class="text-gray-600">Dashboard de suivi et d'optimisation des coûts énergétiques</p>
            </div>
            
            <!-- Statistiques principales -->
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg card-shadow card-hover">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                            <i class="fas fa-bolt text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Consommation Actuelle</p>
                            <p class="text-2xl font-semibold text-gray-900" id="current-consumption">1,250 kWh</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg card-shadow card-hover">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100 text-green-600">
                            <i class="fas fa-euro-sign text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Coût Mensuel</p>
                            <p class="text-2xl font-semibold text-gray-900" id="monthly-cost">€2,340</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg card-shadow card-hover">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-red-100 text-red-600">
                            <i class="fas fa-arrow-up text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Évolution</p>
                            <p class="text-2xl font-semibold text-gray-900" id="evolution">+12%</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg card-shadow card-hover">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                            <i class="fas fa-leaf text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Économies Potentielles</p>
                            <p class="text-2xl font-semibold text-gray-900" id="potential-savings">€420</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Graphique de consommation -->
            <div class="bg-white p-6 rounded-lg card-shadow mb-8">
                <h3 class="text-xl font-semibold mb-4">Consommation Énergétique</h3>
                <div class="chart-container">
                    <canvas id="energy-chart" width="800" height="300"></canvas>
                </div>
            </div>
            
            <!-- Suggestions d'optimisation -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-xl font-semibold mb-4">
                        <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>Suggestions d'Optimisation
                    </h3>
                    <div id="optimization-suggestions" class="space-y-4">
                        <!-- Les suggestions seront ajoutées ici dynamiquement -->
                    </div>
                </div>
                
                <!-- Simulateur d'économies -->
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-xl font-semibold mb-4">
                        <i class="fas fa-calculator text-blue-500 mr-2"></i>Simulateur d'Économies
                    </h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Réduction visée (%)</label>
                        <input type="range" id="savings-slider" min="0" max="30" value="10" class="w-full" oninput="updateSavingsSimulation()">
                        <div class="flex justify-between text-sm text-gray-500">
                            <span>0%</span>
                            <span id="slider-value">10%</span>
                            <span>30%</span>
                        </div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p class="text-sm text-gray-600">Économies mensuelles estimées :</p>
                        <p class="text-2xl font-bold text-green-600" id="simulated-savings">€234</p>
                        <p class="text-sm text-gray-600 mt-2">Économies annuelles : <span id="annual-savings" class="font-semibold">€2,808</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Lieux à risques -->
        <div id="risques-page" class="page-content hidden">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-gray-900">
                    <i class="fas fa-exclamation-triangle text-red-600 mr-3"></i>Lieux à Risques
                </h2>
                <button onclick="showRiskForm()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                    <i class="fas fa-plus mr-2"></i>Nouveau Signalement
                </button>
            </div>
            
            <!-- Formulaire de signalement -->
            <div id="risk-form" class="hidden bg-white p-6 rounded-lg card-shadow mb-8">
                <h3 class="text-xl font-semibold mb-4">Nouveau signalement de risque</h3>
                <form onsubmit="addRiskReport(event)">
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Zone/Lieu</label>
                            <input type="text" id="risk-lieu" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Niveau de risque</label>
                            <select id="risk-niveau" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="">Sélectionner...</option>
                                <option value="low">Bas</option>
                                <option value="medium">Moyen</option>
                                <option value="high">Haut</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description du risque</label>
                        <textarea id="risk-description" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Actions recommandées</label>
                        <textarea id="risk-actions" required rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"></textarea>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-save mr-2"></i>Créer le signalement
                        </button>
                        <button type="button" onclick="hideRiskForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-times mr-2"></i>Annuler
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Plan/Carte des risques -->
            <div class="bg-white p-6 rounded-lg card-shadow mb-8">
                <h3 class="text-xl font-semibold mb-4">Plan du Site - Zones à Risques</h3>
                <div class="risk-map" id="risk-map">
                    <!-- Les zones seront générées dynamiquement -->
                </div>
                <div class="flex justify-center mt-4 space-x-6">
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-red-200 border-2 border-red-500 rounded mr-2"></div>
                        <span class="text-sm">Risque Haut</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-yellow-200 border-2 border-yellow-500 rounded mr-2"></div>
                        <span class="text-sm">Risque Moyen</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-green-200 border-2 border-green-500 rounded mr-2"></div>
                        <span class="text-sm">Risque Bas</span>
                    </div>
                </div>
            </div>
            
            <!-- Liste détaillée des risques -->
            <div class="bg-white p-6 rounded-lg card-shadow">
                <h3 class="text-xl font-semibold mb-4">Liste des Signalements</h3>
                <div id="risks-list" class="space-y-4">
                    <!-- Les signalements seront ajoutés ici dynamiquement -->
                </div>
            </div>
        </div>

        <!-- Page Réduction Consommation -->
        <div id="reduction-page" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">
                    <i class="fas fa-leaf text-green-600 mr-3"></i>Réduction de Consommation
                </h2>
                <p class="text-gray-600">Outils et initiatives pour réduire la consommation énergétique</p>
            </div>
            
            <!-- Checklist d'actions -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-xl font-semibold mb-4">
                        <i class="fas fa-check-square text-green-500 mr-2"></i>Checklist d'Actions
                    </h3>
                    <div id="actions-checklist" class="space-y-3">
                        <!-- La checklist sera générée dynamiquement -->
                    </div>
                    <button onclick="showActionForm()" class="mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm">
                        <i class="fas fa-plus mr-2"></i>Ajouter une action
                    </button>
                </div>
                
                <!-- Suivi des initiatives -->
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-xl font-semibold mb-4">
                        <i class="fas fa-chart-line text-blue-500 mr-2"></i>Initiatives en Cours
                    </h3>
                    <div id="initiatives-list" class="space-y-4">
                        <!-- Les initiatives seront ajoutées ici dynamiquement -->
                    </div>
                    <button onclick="showInitiativeForm()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm">
                        <i class="fas fa-plus mr-2"></i>Nouvelle initiative
                    </button>
                </div>
            </div>
            
            <!-- Formulaire d'action (caché par défaut) -->
            <div id="action-form" class="hidden bg-white p-6 rounded-lg card-shadow mb-8">
                <h3 class="text-xl font-semibold mb-4">Ajouter une action</h3>
                <form onsubmit="addAction(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description de l'action</label>
                        <input type="text" id="action-description" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-save mr-2"></i>Ajouter
                        </button>
                        <button type="button" onclick="hideActionForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-times mr-2"></i>Annuler
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Formulaire d'initiative (caché par défaut) -->
            <div id="initiative-form" class="hidden bg-white p-6 rounded-lg card-shadow mb-8">
                <h3 class="text-xl font-semibold mb-4">Nouvelle initiative</h3>
                <form onsubmit="addInitiative(event)">
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Titre</label>
                            <input type="text" id="initiative-titre" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Responsable</label>
                            <input type="text" id="initiative-responsable" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Statut</label>
                            <select id="initiative-statut" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="planifie">Planifié</option>
                                <option value="en_cours">En cours</option>
                                <option value="termine">Terminé</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Impact estimé (€/mois)</label>
                            <input type="number" id="initiative-impact" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-save mr-2"></i>Créer
                        </button>
                        <button type="button" onclick="hideInitiativeForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-times mr-2"></i>Annuler
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Rapports et export -->
            <div class="bg-white p-6 rounded-lg card-shadow">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-file-export text-purple-500 mr-2"></i>Rapports et Export
                </h3>
                <div class="grid md:grid-cols-3 gap-4">
                    <button onclick="exportReport('actions')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md">
                        <i class="fas fa-download mr-2"></i>Export Actions
                    </button>
                    <button onclick="exportReport('initiatives')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md">
                        <i class="fas fa-download mr-2"></i>Export Initiatives
                    </button>
                    <button onclick="exportReport('summary')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md">
                        <i class="fas fa-download mr-2"></i>Rapport Synthèse
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal pour les détails des demandes de maintenance -->
    <div id="maintenance-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-screen overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Détails de la demande</h3>
                    <button onclick="closeMaintenanceModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="maintenance-modal-content">
                    <!-- Le contenu sera ajouté dynamiquement -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales pour la gestion des données
        let currentPage = 'maintenance';
        
        // Mock data initial - stocké dans localStorage
        const mockData = {
            maintenance: [
                {
                    id: 1,
                    site: "Atelier A",
                    equipement: "Compresseur principal",
                    description: "Bruit anormal et vibrations excessives",
                    urgence: "haute",
                    statut: "ouvert",
                    date: "2024-01-15",
                    assignee: null,
                    comments: [],
                    timeline: [
                        { date: "2024-01-15", action: "Demande créée", user: "Jean Dupont" }
                    ]
                },
                {
                    id: 2,
                    site: "Bureau",
                    equipement: "Climatisation",
                    description: "Température trop élevée dans la zone bureau",
                    urgence: "moyenne",
                    statut: "en-cours",
                    date: "2024-01-14",
                    assignee: "Marie Martin",
                    comments: [
                        { date: "2024-01-14", text: "Vérification en cours", user: "Marie Martin" }
                    ],
                    timeline: [
                        { date: "2024-01-14", action: "Demande créée", user: "Sophie Leroy" },
                        { date: "2024-01-14", action: "Assignée à Marie Martin", user: "Chef d'équipe" }
                    ]
                }
            ],
            energy: {
                consumption: [1200, 1250, 1180, 1300, 1220, 1280, 1250],
                costs: [2200, 2340, 2150, 2450, 2280, 2380, 2340],
                suggestions: [
                    {
                        id: 1,
                        title: "Décaler les plages horaires",
                        description: "Utiliser les équipements pendant les heures creuses",
                        savings: 180,
                        difficulty: "facile"
                    },
                    {
                        id: 2,
                        title: "Maintenance préventive",
                        description: "Nettoyer et calibrer les équipements",
                        savings: 120,
                        difficulty: "moyenne"
                    },
                    {
                        id: 3,
                        title: "Isolation thermique",
                        description: "Améliorer l'isolation des bâtiments",
                        savings: 300,
                        difficulty: "difficile"
                    }
                ]
            },
            risks: [
                {
                    id: 1,
                    lieu: "Atelier A - Zone soudure",
                    niveau: "high",
                    description: "Risque d'incendie - matériaux inflammables stockés près des postes de soudure",
                    actions: "Déplacer le stockage, installer extincteurs supplémentaires",
                    date: "2024-01-10",
                    statut: "ouvert"
                },
                {
                    id: 2,
                    lieu: "Parking - Zone livraison",
                    niveau: "medium",
                    description: "Sol glissant par temps de pluie",
                    actions: "Refaire le revêtement antidérapant",
                    date: "2024-01-12",
                    statut: "en-cours"
                }
            ],
            actions: [
                { id: 1, description: "Éteindre les équipements non utilisés", completed: true },
                { id: 2, description: "Vérifier l'isolation des bâtiments", completed: false },
                { id: 3, description: "Optimiser les horaires de chauffage", completed: true },
                { id: 4, description: "Former le personnel aux économies d'énergie", completed: false }
            ],
            initiatives: [
                {
                    id: 1,
                    titre: "Installation panneaux solaires",
                    responsable: "Jean Dupont",
                    statut: "en_cours",
                    impact: 450,
                    date: "2024-01-01"
                },
                {
                    id: 2,
                    titre: "Remplacement éclairage LED",
                    responsable: "Marie Martin",
                    statut: "termine",
                    impact: 180,
                    date: "2023-12-15"
                }
            ]
        };

        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', function() {
            loadDataFromStorage();
            showPage('maintenance');
            initializeEnergyChart();
            generateRiskMap();
        });

        // Gestion de la navigation
        function showPage(pageId) {
            // Masquer toutes les pages
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => page.classList.add('hidden'));
            
            // Afficher la page sélectionnée
            const targetPage = document.getElementById(pageId + '-page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('fade-in');
            }
            
            // Mettre à jour la navigation active
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('bg-blue-700'));
            
            currentPage = pageId;
            
            // Charger le contenu de la page
            switch(pageId) {
                case 'maintenance':
                    loadMaintenanceKanban();
                    break;
                case 'energie':
                    loadEnergyDashboard();
                    break;
                case 'risques':
                    loadRisksList();
                    generateRiskMap();
                    break;
                case 'reduction':
                    loadActionsChecklist();
                    loadInitiativesList();
                    break;
            }
            
            // Fermer le menu mobile
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        // Toggle menu mobile
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        }

        // Gestion du localStorage
        function saveDataToStorage() {
            localStorage.setItem('industrialSiteData', JSON.stringify(mockData));
        }

        function loadDataFromStorage() {
            const savedData = localStorage.getItem('industrialSiteData');
            if (savedData) {
                Object.assign(mockData, JSON.parse(savedData));
            }
        }

        // MAINTENANCE - Fonctions
        function showMaintenanceForm() {
            document.getElementById('maintenance-form').classList.remove('hidden');
        }

        function hideMaintenanceForm() {
            document.getElementById('maintenance-form').classList.add('hidden');
            document.getElementById('maintenance-form').querySelector('form').reset();
        }

        function addMaintenanceRequest(event) {
            event.preventDefault();
            
            const newRequest = {
                id: Date.now(),
                site: document.getElementById('maintenance-site').value,
                equipement: document.getElementById('maintenance-equipement').value,
                description: document.getElementById('maintenance-description').value,
                urgence: document.getElementById('maintenance-urgence').value,
                statut: 'ouvert',
                date: new Date().toISOString().split('T')[0],
                assignee: null,
                comments: [],
                timeline: [
                    { date: new Date().toISOString().split('T')[0], action: "Demande créée", user: "Utilisateur" }
                ]
            };
            
            mockData.maintenance.push(newRequest);
            saveDataToStorage();
            loadMaintenanceKanban();
            hideMaintenanceForm();
            
            // Message de confirmation
            showNotification('Demande de maintenance créée avec succès', 'success');
        }

        function loadMaintenanceKanban() {
            const statuts = ['ouvert', 'en-cours', 'resolu'];
            
            statuts.forEach(statut => {
                const container = document.getElementById(`kanban-${statut}`);
                container.innerHTML = '';
                
                const requests = mockData.maintenance.filter(req => req.statut === statut);
                
                requests.forEach(request => {
                    const card = document.createElement('div');
                    card.className = `kanban-card priority-${request.urgence}`;
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-semibold text-gray-900">${request.equipement}</h4>
                            <span class="text-xs px-2 py-1 rounded-full ${getPriorityClass(request.urgence)}">${request.urgence}</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">${request.site}</p>
                        <p class="text-sm text-gray-700 mb-3">${request.description}</p>
                        <div class="flex justify-between items-center text-xs text-gray-500">
                            <span>${new Date(request.date).toLocaleDateString('fr-FR')}</span>
                            <button onclick="openMaintenanceModal(${request.id})" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        ${request.assignee ? `<div class="mt-2 text-xs text-blue-600">Assigné à: ${request.assignee}</div>` : ''}
                        <div class="mt-2 flex space-x-2">
                            ${statut !== 'resolu' ? `<button onclick="changeMaintenanceStatus(${request.id}, '${getNextStatus(statut)}')" class="text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600">
                                ${getNextStatus(statut) === 'en-cours' ? 'Démarrer' : 'Terminer'}
                            </button>` : ''}
                            ${!request.assignee ? `<button onclick="assignMaintenance(${request.id})" class="text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600">
                                Assigner
                            </button>` : ''}
                        </div>
                    `;
                    container.appendChild(card);
                });
            });
        }

        function getPriorityClass(priority) {
            const classes = {
                'basse': 'bg-green-100 text-green-800',
                'moyenne': 'bg-yellow-100 text-yellow-800',
                'haute': 'bg-red-100 text-red-800'
            };
            return classes[priority] || 'bg-gray-100 text-gray-800';
        }

        function getNextStatus(currentStatus) {
            const statusFlow = {
                'ouvert': 'en-cours',
                'en-cours': 'resolu'
            };
            return statusFlow[currentStatus];
        }

        function changeMaintenanceStatus(id, newStatus) {
            const request = mockData.maintenance.find(req => req.id === id);
            if (request) {
                request.statut = newStatus;
                request.timeline.push({
                    date: new Date().toISOString().split('T')[0],
                    action: `Statut changé vers ${newStatus}`,
                    user: "Utilisateur"
                });
                saveDataToStorage();
                loadMaintenanceKanban();
                showNotification(`Statut mis à jour vers ${newStatus}`, 'success');
            }
        }

        function assignMaintenance(id) {
            const assignee = prompt('Nom de la personne à assigner:');
            if (assignee) {
                const request = mockData.maintenance.find(req => req.id === id);
                if (request) {
                    request.assignee = assignee;
                    request.timeline.push({
                        date: new Date().toISOString().split('T')[0],
                        action: `Assigné à ${assignee}`,
                        user: "Utilisateur"
                    });
                    saveDataToStorage();
                    loadMaintenanceKanban();
                    showNotification(`Demande assignée à ${assignee}`, 'success');
                }
            }
        }

        function openMaintenanceModal(id) {
            const request = mockData.maintenance.find(req => req.id === id);
            if (!request) return;
            
            const modal = document.getElementById('maintenance-modal');
            const content = document.getElementById('maintenance-modal-content');
            
            content.innerHTML = `
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-2">${request.equipement}</h4>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <span class="text-sm font-medium text-gray-600">Site:</span>
                            <p class="text-gray-900">${request.site}</p>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-600">Urgence:</span>
                            <span class="px-2 py-1 rounded-full text-xs ${getPriorityClass(request.urgence)}">${request.urgence}</span>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-600">Statut:</span>
                            <span class="px-2 py-1 rounded-full text-xs status-${request.statut}">${request.statut}</span>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-600">Date:</span>
                            <p class="text-gray-900">${new Date(request.date).toLocaleDateString('fr-FR')}</p>
                        </div>
                    </div>
                    <div class="mb-4">
                        <span class="text-sm font-medium text-gray-600">Description:</span>
                        <p class="text-gray-900 mt-1">${request.description}</p>
                    </div>
                    ${request.assignee ? `
                        <div class="mb-4">
                            <span class="text-sm font-medium text-gray-600">Assigné à:</span>
                            <p class="text-gray-900">${request.assignee}</p>
                        </div>
                    ` : ''}
                </div>
                
                <!-- Timeline -->
                <div class="mb-6">
                    <h5 class="text-md font-semibold mb-3">Historique</h5>
                    <div class="space-y-3">
                        ${request.timeline.map(item => `
                            <div class="timeline-item">
                                <div class="timeline-dot"></div>
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <p class="text-sm font-medium">${item.action}</p>
                                    <p class="text-xs text-gray-500">Par ${item.user} le ${new Date(item.date).toLocaleDateString('fr-FR')}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Commentaires -->
                <div class="mb-6">
                    <h5 class="text-md font-semibold mb-3">Commentaires</h5>
                    <div class="space-y-2 mb-3">
                        ${request.comments.map(comment => `
                            <div class="bg-blue-50 p-3 rounded-lg">
                                <p class="text-sm">${comment.text}</p>
                                <p class="text-xs text-gray-500 mt-1">Par ${comment.user} le ${new Date(comment.date).toLocaleDateString('fr-FR')}</p>
                            </div>
                        `).join('')}
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="new-comment" placeholder="Ajouter un commentaire..." class="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm">
                        <button onclick="addMaintenanceComment(${request.id})" class="bg-blue-600 text-white px-3 py-2 rounded-md text-sm hover:bg-blue-700">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function closeMaintenanceModal() {
            document.getElementById('maintenance-modal').classList.add('hidden');
        }

        function addMaintenanceComment(id) {
            const commentText = document.getElementById('new-comment').value.trim();
            if (!commentText) return;
            
            const request = mockData.maintenance.find(req => req.id === id);
            if (request) {
                request.comments.push({
                    date: new Date().toISOString().split('T')[0],
                    text: commentText,
                    user: "Utilisateur"
                });
                saveDataToStorage();
                openMaintenanceModal(id); // Recharger la modal
                showNotification('Commentaire ajouté', 'success');
            }
        }

        // ÉNERGIE - Fonctions
        function loadEnergyDashboard() {
            loadOptimizationSuggestions();
            updateSavingsSimulation();
        }

        function initializeEnergyChart() {
            const canvas = document.getElementById('energy-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const data = mockData.energy.consumption;
            
            // Configuration du graphique
            const width = canvas.width;
            const height = canvas.height;
            const padding = 40;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            
            // Effacer le canvas
            ctx.clearRect(0, 0, width, height);
            
            // Trouver les valeurs min et max
            const maxValue = Math.max(...data);
            const minValue = Math.min(...data);
            const range = maxValue - minValue;
            
            // Dessiner les axes
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            // Axe Y
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            
            // Axe X
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Dessiner la courbe
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = padding + (index * chartWidth) / (data.length - 1);
                const y = height - padding - ((value - minValue) / range) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // Dessiner les points
            ctx.fillStyle = '#3b82f6';
            data.forEach((value, index) => {
                const x = padding + (index * chartWidth) / (data.length - 1);
                const y = height - padding - ((value - minValue) / range) * chartHeight;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            // Ajouter les labels
            ctx.fillStyle = '#6b7280';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            
            const days = ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'];
            days.forEach((day, index) => {
                const x = padding + (index * chartWidth) / (data.length - 1);
                ctx.fillText(day, x, height - 10);
            });
        }

        function loadOptimizationSuggestions() {
            const container = document.getElementById('optimization-suggestions');
            container.innerHTML = '';
            
            mockData.energy.suggestions.forEach(suggestion => {
                const div = document.createElement('div');
                div.className = 'p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors duration-200';
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-gray-900">${suggestion.title}</h4>
                        <span class="text-sm font-bold text-green-600">€${suggestion.savings}/mois</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${suggestion.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs px-2 py-1 rounded-full ${getDifficultyClass(suggestion.difficulty)}">${suggestion.difficulty}</span>
                        <button onclick="applySuggestion(${suggestion.id})" class="text-sm bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
                            Appliquer
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function getDifficultyClass(difficulty) {
            const classes = {
                'facile': 'bg-green-100 text-green-800',
                'moyenne': 'bg-yellow-100 text-yellow-800',
                'difficile': 'bg-red-100 text-red-800'
            };
            return classes[difficulty] || 'bg-gray-100 text-gray-800';
        }

        function applySuggestion(id) {
            const suggestion = mockData.energy.suggestions.find(s => s.id === id);
            if (suggestion && confirm(`Appliquer la suggestion "${suggestion.title}" ?`)) {
                showNotification(`Suggestion "${suggestion.title}" appliquée avec succès`, 'success');
                // Ici on pourrait marquer la suggestion comme appliquée
            }
        }

        function updateSavingsSimulation() {
            const slider = document.getElementById('savings-slider');
            const sliderValue = document.getElementById('slider-value');
            const simulatedSavings = document.getElementById('simulated-savings');
            const annualSavings = document.getElementById('annual-savings');
            
            if (!slider) return;
            
            const percentage = slider.value;
            const currentCost = 2340; // Coût mensuel actuel
            const monthlySavings = Math.round(currentCost * (percentage / 100));
            const yearlySavings = monthlySavings * 12;
            
            sliderValue.textContent = percentage + '%';
            simulatedSavings.textContent = '€' + monthlySavings;
            annualSavings.textContent = '€' + yearlySavings.toLocaleString();
        }

        // RISQUES - Fonctions
        function showRiskForm() {
            document.getElementById('risk-form').classList.remove('hidden');
        }

        function hideRiskForm() {
            document.getElementById('risk-form').classList.add('hidden');
            document.getElementById('risk-form').querySelector('form').reset();
        }

        function addRiskReport(event) {
            event.preventDefault();
            
            const newRisk = {
                id: Date.now(),
                lieu: document.getElementById('risk-lieu').value,
                niveau: document.getElementById('risk-niveau').value,
                description: document.getElementById('risk-description').value,
                actions: document.getElementById('risk-actions').value,
                date: new Date().toISOString().split('T')[0],
                statut: 'ouvert'
            };
            
            mockData.risks.push(newRisk);
            saveDataToStorage();
            loadRisksList();
            generateRiskMap();
            hideRiskForm();
            
            showNotification('Signalement de risque créé avec succès', 'success');
        }

        function loadRisksList() {
            const container = document.getElementById('risks-list');
            container.innerHTML = '';
            
            mockData.risks.forEach(risk => {
                const div = document.createElement('div');
                div.className = `p-4 border-l-4 rounded-lg ${getRiskClass(risk.niveau)} mb-4`;
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-gray-900">${risk.lieu}</h4>
                        <div class="flex items-center space-x-2">
                            <span class="text-xs px-2 py-1 rounded-full ${getRiskBadgeClass(risk.niveau)}">${getRiskLabel(risk.niveau)}</span>
                            <button onclick="deleteRisk(${risk.id})" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash text-sm"></i>
                            </button>
                        </div>
                    </div>
                    <p class="text-sm text-gray-700 mb-2">${risk.description}</p>
                    <div class="mb-2">
                        <span class="text-sm font-medium text-gray-600">Actions recommandées:</span>
                        <p class="text-sm text-gray-700">${risk.actions}</p>
                    </div>
                    <div class="flex justify-between items-center text-xs text-gray-500">
                        <span>Signalé le ${new Date(risk.date).toLocaleDateString('fr-FR')}</span>
                        <span class="px-2 py-1 rounded-full ${getStatusClass(risk.statut)}">${risk.statut}</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function getRiskClass(niveau) {
            const classes = {
                'high': 'risk-high',
                'medium': 'risk-medium',
                'low': 'risk-low'
            };
            return classes[niveau] || 'border-gray-300';
        }

        function getRiskBadgeClass(niveau) {
            const classes = {
                'high': 'bg-red-100 text-red-800',
                'medium': 'bg-yellow-100 text-yellow-800',
                'low': 'bg-green-100 text-green-800'
            };
            return classes[niveau] || 'bg-gray-100 text-gray-800';
        }

        function getRiskLabel(niveau) {
            const labels = {
                'high': 'Haut',
                'medium': 'Moyen',
                'low': 'Bas'
            };
            return labels[niveau] || niveau;
        }

        function getStatusClass(statut) {
            const classes = {
                'ouvert': 'bg-red-100 text-red-800',
                'en-cours': 'bg-yellow-100 text-yellow-800',
                'resolu': 'bg-green-100 text-green-800'
            };
            return classes[statut] || 'bg-gray-100 text-gray-800';
        }

        function generateRiskMap() {
            const container = document.getElementById('risk-map');
            container.innerHTML = '';
            
            // Créer une grille 4x4 représentant le site
            const zones = [
                { name: 'Atelier A', risk: 'high' },
                { name: 'Atelier B', risk: 'medium' },
                { name: 'Bureau', risk: 'low' },
                { name: 'Entrepôt', risk: 'low' },
                { name: 'Parking', risk: 'medium' },
                { name: 'Cantine', risk: 'low' },
                { name: 'Vestiaires', risk: 'low' },
                { name: 'Maintenance', risk: 'high' },
                { name: 'Réception', risk: 'low' },
                { name: 'Stockage', risk: 'medium' },
                { name: 'Laboratoire', risk: 'high' },
                { name: 'Salle serveur', risk: 'medium' },
                { name: 'Chaufferie', risk: 'high' },
                { name: 'Extérieur', risk: 'low' },
                { name: 'Quai', risk: 'medium' },
                { name: 'Sécurité', risk: 'low' }
            ];
            
            zones.forEach((zone, index) => {
                const div = document.createElement('div');
                div.className = `risk-zone ${getRiskClass(zone.risk)}`;
                div.innerHTML = `
                    <div class="text-center">
                        <div class="text-xs font-medium">${zone.name}</div>
                        <div class="text-xs mt-1">${getRiskLabel(zone.risk)}</div>
                    </div>
                `;
                div.onclick = () => showZoneDetails(zone);
                container.appendChild(div);
            });
        }

        function showZoneDetails(zone) {
            alert(`Zone: ${zone.name}\nNiveau de risque: ${getRiskLabel(zone.risk)}`);
        }

        function deleteRisk(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce signalement ?')) {
                mockData.risks = mockData.risks.filter(risk => risk.id !== id);
                saveDataToStorage();
                loadRisksList();
                generateRiskMap();
                showNotification('Signalement supprimé', 'success');
            }
        }

        // RÉDUCTION CONSOMMATION - Fonctions
        function loadActionsChecklist() {
            const container = document.getElementById('actions-checklist');
            container.innerHTML = '';
            
            mockData.actions.forEach(action => {
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-3 p-2 hover:bg-gray-50 rounded';
                div.innerHTML = `
                    <input type="checkbox" ${action.completed ? 'checked' : ''} 
                           onchange="toggleAction(${action.id})" 
                           class="w-4 h-4 text-green-600 rounded focus:ring-green-500">
                    <span class="${action.completed ? 'line-through text-gray-500' : 'text-gray-900'}">${action.description}</span>
                    <button onclick="deleteAction(${action.id})" class="text-red-500 hover:text-red-700 ml-auto">
                        <i class="fas fa-trash text-sm"></i>
                    </button>
                `;
                container.appendChild(div);
            });
        }

        function toggleAction(id) {
            const action = mockData.actions.find(a => a.id === id);
            if (action) {
                action.completed = !action.completed;
                saveDataToStorage();
                loadActionsChecklist();
            }
        }

        function deleteAction(id) {
            if (confirm('Supprimer cette action ?')) {
                mockData.actions = mockData.actions.filter(a => a.id !== id);
                saveDataToStorage();
                loadActionsChecklist();
            }
        }

        function showActionForm() {
            document.getElementById('action-form').classList.remove('hidden');
        }

        function hideActionForm() {
            document.getElementById('action-form').classList.add('hidden');
            document.getElementById('action-form').querySelector('form').reset();
        }

        function addAction(event) {
            event.preventDefault();
            
            const newAction = {
                id: Date.now(),
                description: document.getElementById('action-description').value,
                completed: false
            };
            
            mockData.actions.push(newAction);
            saveDataToStorage();
            loadActionsChecklist();
            hideActionForm();
            
            showNotification('Action ajoutée', 'success');
        }

        function loadInitiativesList() {
            const container = document.getElementById('initiatives-list');
            container.innerHTML = '';
            
            mockData.initiatives.forEach(initiative => {
                const div = document.createElement('div');
                div.className = 'p-4 border border-gray-200 rounded-lg';
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-gray-900">${initiative.titre}</h4>
                        <button onclick="deleteInitiative(${initiative.id})" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash text-sm"></i>
                        </button>
                    </div>
                    <div class="grid md:grid-cols-2 gap-2 text-sm text-gray-600 mb-2">
                        <div>Responsable: ${initiative.responsable}</div>
                        <div>Impact: €${initiative.impact}/mois</div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs px-2 py-1 rounded-full ${getInitiativeStatusClass(initiative.statut)}">${getInitiativeStatusLabel(initiative.statut)}</span>
                        <span class="text-xs text-gray-500">${new Date(initiative.date).toLocaleDateString('fr-FR')}</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function getInitiativeStatusClass(statut) {
            const classes = {
                'planifie': 'bg-yellow-100 text-yellow-800',
                'en_cours': 'bg-blue-100 text-blue-800',
                'termine': 'bg-green-100 text-green-800'
            };
            return classes[statut] || 'bg-gray-100 text-gray-800';
        }

        function getInitiativeStatusLabel(statut) {
            const labels = {
                'planifie': 'Planifié',
                'en_cours': 'En cours',
                'termine': 'Terminé'
            };
            return labels[statut] || statut;
        }

        function showInitiativeForm() {
            document.getElementById('initiative-form').classList.remove('hidden');
        }

        function hideInitiativeForm() {
            document.getElementById('initiative-form').classList.add('hidden');
            document.getElementById('initiative-form').querySelector('form').reset();
        }

        function addInitiative(event) {
            event.preventDefault();
            
            const newInitiative = {
                id: Date.now(),
                titre: document.getElementById('initiative-titre').value,
                responsable: document.getElementById('initiative-responsable').value,
                statut: document.getElementById('initiative-statut').value,
                impact: parseInt(document.getElementById('initiative-impact').value),
                date: new Date().toISOString().split('T')[0]
            };
            
            mockData.initiatives.push(newInitiative);
            saveDataToStorage();
            loadInitiativesList();
            hideInitiativeForm();
            
            showNotification('Initiative créée', 'success');
        }

        function deleteInitiative(id) {
            if (confirm('Supprimer cette initiative ?')) {
                mockData.initiatives = mockData.initiatives.filter(i => i.id !== id);
                saveDataToStorage();
                loadInitiativesList();
            }
        }

        function exportReport(type) {
            let data;
            let filename;
            
            switch(type) {
                case 'actions':
                    data = mockData.actions;
                    filename = 'actions_reduction_conso.json';
                    break;
                case 'initiatives':
                    data = mockData.initiatives;
                    filename = 'initiatives_reduction_conso.json';
                    break;
                case 'summary':
                    data = {
                        actions: mockData.actions,
                        initiatives: mockData.initiatives,
                        summary: {
                            totalActions: mockData.actions.length,
                            completedActions: mockData.actions.filter(a => a.completed).length,
                            totalInitiatives: mockData.initiatives.length,
                            totalImpact: mockData.initiatives.reduce((sum, i) => sum + i.impact, 0)
                        }
                    };
                    filename = 'rapport_synthese_reduction_conso.json';
                    break;
                default:
                    return;
            }
            
            // Créer et télécharger le fichier JSON
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(`Rapport ${type} exporté`, 'success');
        }

        // Fonction utilitaire pour les notifications
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Supprimer la notification après 3 secondes
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Fermer les modals en cliquant à l'extérieur
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('maintenance-modal');
            if (modal && event.target === modal) {
                closeMaintenanceModal();
            }
        });

        // Fermer les modals avec la touche Échap
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('maintenance-modal');
                if (modal && !modal.classList.contains('hidden')) {
                    closeMaintenanceModal();
                }
            }
        });
    </script>
</body>
</html>