<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Site Industriel</title>
    <!-- TailwindCSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Styles personnalisés inspirés de l'image */
        .gradient-bg {
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
        }
        
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .status-ouvert { background-color: #fef3c7; color: #92400e; }
        .status-en-cours { background-color: #dbeafe; color: #1e40af; }
        .status-resolu { background-color: #d1fae5; color: #065f46; }
        
        .priority-haute { border-left: 4px solid #ef4444; }
        .priority-moyenne { border-left: 4px solid #f59e0b; }
        .priority-basse { border-left: 4px solid #10b981; }
        
        .risk-haut { background-color: #fee2e2; border-color: #ef4444; }
        .risk-moyen { background-color: #fef3c7; border-color: #f59e0b; }
        .risk-bas { background-color: #d1fae5; border-color: #10b981; }
        
        .hidden { display: none !important; }
        
        /* Styles pour les graphiques */
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        /* Styles pour la carte des risques */
        .risk-map {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid #cbd5e1;
            border-radius: 12px;
            position: relative;
            min-height: 400px;
        }
        
        .risk-point {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        
        .risk-point:hover {
            transform: scale(1.2);
            z-index: 10;
        }
        
        .risk-point.haut {
            background-color: #ef4444;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.3);
        }
        
        .risk-point.moyen {
            background-color: #f59e0b;
            box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.3);
        }
        
        .risk-point.bas {
            background-color: #10b981;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.3);
        }
        
        /* Kanban styles */
        .kanban-column {
            min-height: 500px;
            background-color: #f8fafc;
            border-radius: 8px;
            padding: 16px;
        }
        
        .kanban-card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: move;
            transition: all 0.3s ease;
        }
        
        .kanban-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Timeline styles */
        .timeline-item {
            position: relative;
            padding-left: 40px;
            margin-bottom: 20px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: -20px;
            width: 2px;
            background: #e5e7eb;
        }
        
        .timeline-item:last-child::before {
            display: none;
        }
        
        .timeline-dot {
            position: absolute;
            left: 10px;
            top: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #3b82f6;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #3b82f6;
        }
        
        /* Animations pour les graphiques */
        .bar-animation {
            animation: growBar 1s ease-out;
        }
        
        @keyframes growBar {
            from { height: 0; }
            to { height: var(--bar-height); }
        }
        
        /* Styles pour les modals */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        /* Styles pour les notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: #10b981;
        }
        
        .notification.error {
            background-color: #ef4444;
        }
        
        .notification.warning {
            background-color: #f59e0b;
        }
        
        .notification.info {
            background-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation Bar -->
    <nav class="gradient-bg text-white shadow-lg sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo/Titre -->
                <div class="flex items-center">
                    <i class="fas fa-industry text-2xl mr-3"></i>
                    <h1 class="text-xl font-bold">Gestion Site Industriel</h1>
                </div>
                
                <!-- Menu Desktop -->
                <div class="hidden md:flex space-x-8">
                    <button onclick="showPage('maintenance')" class="nav-link hover:text-cyan-200 transition-colors duration-200 px-3 py-2 rounded-md">
                        <i class="fas fa-tools mr-2"></i>Maintenance
                    </button>
                    <button onclick="showPage('energie')" class="nav-link hover:text-cyan-200 transition-colors duration-200 px-3 py-2 rounded-md">
                        <i class="fas fa-bolt mr-2"></i>Énergie
                    </button>
                    <button onclick="showPage('risques')" class="nav-link hover:text-cyan-200 transition-colors duration-200 px-3 py-2 rounded-md">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Lieux à risques
                    </button>
                    <button onclick="showPage('reduction')" class="nav-link hover:text-cyan-200 transition-colors duration-200 px-3 py-2 rounded-md">
                        <i class="fas fa-leaf mr-2"></i>Réduction conso
                    </button>
                </div>
                
                <!-- Menu Desktop -->
                <div class="hidden md:flex space-x-8">
                    <button onclick="showPage('maintenance')" class="nav-link hover:text-blue-200 transition-colors duration-200 px-3 py-2 rounded-md">
                        <i class="fas fa-tools mr-2"></i>Maintenance
                    </button>
                    <button onclick="showPage('energie')" class="nav-link hover:text-blue-200 transition-colors duration-200 px-3 py-2 rounded-md">
                        <i class="fas fa-bolt mr-2"></i>Énergie
                    </button>
                    <button onclick="showPage('risques')" class="nav-link hover:text-blue-200 transition-colors duration-200 px-3 py-2 rounded-md">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Lieux à risques
                    </button>
                    <button onclick="showPage('reduction')" class="nav-link hover:text-blue-200 transition-colors duration-200 px-3 py-2 rounded-md">
                        <i class="fas fa-leaf mr-2"></i>Réduction conso
                    </button>
                </div>
                
                <!-- Menu Mobile -->
                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()" class="text-white hover:text-cyan-200">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- Menu Mobile Dropdown -->
            <div id="mobile-menu" class="hidden md:hidden pb-4">
                <button onclick="showPage('maintenance')" class="block w-full text-left px-3 py-2 hover:bg-cyan-600 rounded-md">
                    <i class="fas fa-tools mr-2"></i>Maintenance
                </button>
                <button onclick="showPage('energie')" class="block w-full text-left px-3 py-2 hover:bg-cyan-600 rounded-md">
                    <i class="fas fa-bolt mr-2"></i>Énergie
                </button>
                <button onclick="showPage('risques')" class="block w-full text-left px-3 py-2 hover:bg-cyan-600 rounded-md">
                    <i class="fas fa-exclamation-triangle mr-2"></i>Lieux à risques
                </button>
                <button onclick="showPage('reduction')" class="block w-full text-left px-3 py-2 hover:bg-cyan-600 rounded-md">
                    <i class="fas fa-leaf mr-2"></i>Réduction conso
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenu Principal -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Page Maintenance -->
        <div id="maintenance-page" class="page-content">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">
                        <i class="fas fa-tools text-blue-600 mr-3"></i>Maintenance
                    </h2>
                    <p class="text-gray-600">Gestion des demandes de maintenance et suivi des interventions</p>
                </div>
                <button onclick="showMaintenanceForm()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                    <i class="fas fa-plus mr-2"></i>Nouvelle Demande
                </button>
            </div>
            
            <!-- Formulaire de création de demande -->
            <div id="maintenance-form" class="hidden bg-white p-6 rounded-lg shadow-md mb-8">
                <h3 class="text-xl font-semibold mb-4">Nouvelle demande de maintenance</h3>
                <form onsubmit="addMaintenanceRequest(event)">
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Site/Zone</label>
                            <select id="maintenance-site" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Sélectionner...</option>
                                <option value="Atelier A">Atelier A</option>
                                <option value="Atelier B">Atelier B</option>
                                <option value="Entrepôt">Entrepôt</option>
                                <option value="Bureau">Bureau</option>
                                <option value="Extérieur">Extérieur</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Équipement</label>
                            <input type="text" id="maintenance-equipement" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description du problème</label>
                        <textarea id="maintenance-description" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Urgence</label>
                            <select id="maintenance-urgence" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Sélectionner...</option>
                                <option value="basse">Basse</option>
                                <option value="moyenne">Moyenne</option>
                                <option value="haute">Haute</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Photo (simulée)</label>
                            <input type="file" id="maintenance-photo" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-save mr-2"></i>Créer la demande
                        </button>
                        <button type="button" onclick="hideMaintenanceForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-times mr-2"></i>Annuler
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Vue Kanban des demandes -->
            <div class="grid md:grid-cols-3 gap-6">
                <div class="kanban-column">
                    <h3 class="text-lg font-semibold mb-4 text-yellow-700">
                        <i class="fas fa-clock mr-2"></i>Ouvert
                        <span id="count-ouvert" class="bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full text-sm ml-2">0</span>
                    </h3>
                    <div id="kanban-ouvert" class="space-y-3">
                        <!-- Les cartes seront ajoutées ici -->
                    </div>
                </div>
                
                <div class="kanban-column">
                    <h3 class="text-lg font-semibold mb-4 text-blue-700">
                        <i class="fas fa-cog mr-2"></i>En cours
                        <span id="count-en-cours" class="bg-blue-200 text-blue-800 px-2 py-1 rounded-full text-sm ml-2">0</span>
                    </h3>
                    <div id="kanban-en-cours" class="space-y-3">
                        <!-- Les cartes seront ajoutées ici -->
                    </div>
                </div>
                
                <div class="kanban-column">
                    <h3 class="text-lg font-semibold mb-4 text-green-700">
                        <i class="fas fa-check mr-2"></i>Résolu
                        <span id="count-resolu" class="bg-green-200 text-green-800 px-2 py-1 rounded-full text-sm ml-2">0</span>
                    </h3>
                    <div id="kanban-resolu" class="space-y-3">
                        <!-- Les cartes seront ajoutées ici -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Énergie -->
        <div id="energie-page" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">
                    <i class="fas fa-bolt text-yellow-500 mr-3"></i>Optimisation Énergétique
                </h2>
                <p class="text-gray-600">Dashboard de suivi et optimisation des coûts énergétiques</p>
            </div>
            
            <!-- Métriques principales -->
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow-md card-hover">
                    <div class="flex items-center">
                        <div class="p-3 bg-blue-100 rounded-full">
                            <i class="fas fa-bolt text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Consommation Actuelle</p>
                            <p id="current-consumption" class="text-2xl font-bold text-gray-900">1,250 kWh</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-md card-hover">
                    <div class="flex items-center">
                        <div class="p-3 bg-green-100 rounded-full">
                            <i class="fas fa-euro-sign text-green-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Coût Mensuel</p>
                            <p id="monthly-cost" class="text-2xl font-bold text-gray-900">€2,340</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-md card-hover">
                    <div class="flex items-center">
                        <div class="p-3 bg-red-100 rounded-full">
                            <i class="fas fa-arrow-down text-red-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Économies Potentielles</p>
                            <p id="potential-savings" class="text-2xl font-bold text-gray-900">€420</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-md card-hover">
                    <div class="flex items-center">
                        <div class="p-3 bg-purple-100 rounded-full">
                            <i class="fas fa-percentage text-purple-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Efficacité</p>
                            <p id="efficiency" class="text-2xl font-bold text-gray-900">78%</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Graphique de consommation -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-4">Consommation Énergétique</h3>
                    <div class="chart-container">
                        <canvas id="consumption-chart" width="400" height="300"></canvas>
                    </div>
                </div>
                
                <!-- Suggestions d'optimisation -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-4">Suggestions d'Optimisation</h3>
                    <div id="optimization-suggestions" class="space-y-4">
                        <!-- Les suggestions seront ajoutées ici -->
                    </div>
                </div>
            </div>
            
            <!-- Simulateur d'économies -->
            <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold mb-4">Simulateur d'Impact</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pourcentage d'économie visé</label>
                        <input type="range" id="savings-slider" min="0" max="50" value="15" class="w-full" oninput="updateSavingsSimulation()">
                        <div class="flex justify-between text-sm text-gray-500 mt-1">
                            <span>0%</span>
                            <span id="slider-value">15%</span>
                            <span>50%</span>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">Économies Projetées</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span>Mensuel:</span>
                                <span id="monthly-savings" class="font-bold text-green-600">€351</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Annuel:</span>
                                <span id="yearly-savings" class="font-bold text-green-600">€4,212</span>
                            </div>
                            <div class="flex justify-between">
                                <span>kWh économisés:</span>
                                <span id="kwh-saved" class="font-bold text-blue-600">187.5 kWh</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Lieux à risques -->
        <div id="risques-page" class="page-content hidden">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">
                        <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>Lieux à Risques
                    </h2>
                    <p class="text-gray-600">Cartographie et gestion des zones sensibles du site</p>
                </div>
                <button onclick="showRiskForm()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
                    <i class="fas fa-plus mr-2"></i>Nouveau Signalement
                </button>
            </div>
            
            <!-- Formulaire de signalement -->
            <div id="risk-form" class="hidden bg-white p-6 rounded-lg shadow-md mb-8">
                <h3 class="text-xl font-semibold mb-4">Nouveau signalement de risque</h3>
                <form onsubmit="addRiskReport(event)">
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Zone/Lieu</label>
                            <input type="text" id="risk-lieu" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Niveau de risque</label>
                            <select id="risk-niveau" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option value="">Sélectionner...</option>
                                <option value="bas">Bas</option>
                                <option value="moyen">Moyen</option>
                                <option value="haut">Haut</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description du risque</label>
                        <textarea id="risk-description" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Actions recommandées</label>
                        <textarea id="risk-actions" required rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"></textarea>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-save mr-2"></i>Créer le signalement
                        </button>
                        <button type="button" onclick="hideRiskForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-times mr-2"></i>Annuler
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Carte/Plan des risques -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-4">Plan du Site</h3>
                    <div class="risk-map" id="risk-map">
                        <!-- Les points de risque seront ajoutés ici -->
                        <div class="absolute top-4 left-4 bg-white p-2 rounded shadow text-sm">
                            <div class="flex items-center mb-1">
                                <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                                <span>Risque Haut</span>
                            </div>
                            <div class="flex items-center mb-1">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                                <span>Risque Moyen</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                <span>Risque Bas</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Liste détaillée des risques -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-4">Signalements Actifs</h3>
                    <div id="risk-list" class="space-y-4 max-h-96 overflow-y-auto">
                        <!-- Les signalements seront ajoutés ici -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Réduction Consommation -->
        <div id="reduction-page" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">
                    <i class="fas fa-leaf text-green-500 mr-3"></i>Réduction de Consommation
                </h2>
                <p class="text-gray-600">Outils et initiatives pour réduire l'impact énergétique</p>
            </div>
            
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Checklist d'actions -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">Checklist d'Actions</h3>
                        <button onclick="showActionForm()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
                            <i class="fas fa-plus mr-1"></i>Ajouter
                        </button>
                    </div>
                    <div id="actions-checklist" class="space-y-3">
                        <!-- Les actions seront ajoutées ici -->
                    </div>
                </div>
                
                <!-- Suivi des initiatives -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-4">Initiatives en Cours</h3>
                    <div id="initiatives-list" class="space-y-4">
                        <!-- Les initiatives seront ajoutées ici -->
                    </div>
                </div>
            </div>
            
            <!-- Formulaire d'ajout d'action -->
            <div id="action-form" class="hidden mt-8 bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold mb-4">Nouvelle action d'économie</h3>
                <form onsubmit="addEconomyAction(event)">
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Titre de l'action</label>
                            <input type="text" id="action-titre" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Impact estimé (%)</label>
                            <input type="number" id="action-impact" min="1" max="50" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="action-description" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Responsable</label>
                            <input type="text" id="action-responsable" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date limite</label>
                            <input type="date" id="action-deadline" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-save mr-2"></i>Ajouter l'action
                        </button>
                        <button type="button" onclick="hideActionForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-times mr-2"></i>Annuler
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Rapports synthétiques -->
            <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Rapports Synthétiques</h3>
                    <button onclick="exportReport()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-download mr-2"></i>Exporter JSON
                    </button>
                </div>
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="text-2xl font-bold text-green-600" id="total-actions">0</div>
                        <div class="text-sm text-gray-600">Actions Totales</div>
                    </div>
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600" id="completed-actions">0</div>
                        <div class="text-sm text-gray-600">Actions Complétées</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="text-2xl font-bold text-purple-600" id="total-impact">0%</div>
                        <div class="text-sm text-gray-600">Impact Total Estimé</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal pour détails des demandes de maintenance -->
    <div id="maintenance-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Détails de la demande</h3>
                    <button onclick="closeMaintenanceModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="maintenance-modal-content">
                    <!-- Le contenu sera ajouté dynamiquement -->
                </div>
            </div>
        </div>
    </div>

    <!-- Zone de notifications -->
    <div id="notification-area"></div>

    <script>
        // Variables globales pour la gestion de l'application
        let currentPage = 'maintenance';
        let maintenanceRequests = [];
        let riskReports = [];
        let economyActions = [];
        let consumptionData = [];

        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', function() {
            loadDataFromStorage();
            initializeMockData();
            showPage('maintenance');
            updateAllCounters();
        });

        // === GESTION DE LA NAVIGATION ===
        function showPage(pageId) {
            // Masquer toutes les pages
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => page.classList.add('hidden'));
            
            // Afficher la page sélectionnée
            const targetPage = document.getElementById(pageId + '-page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('fade-in');
            }
            
            // Mettre à jour la navigation active
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('bg-cyan-600'));
            
            currentPage = pageId;
            
            // Charger le contenu spécifique à la page
            switch(pageId) {
                case 'maintenance':
                    loadMaintenanceKanban();
                    break;
                case 'energie':
                    loadEnergyDashboard();
                    break;
                case 'risques':
                    loadRiskMap();
                    loadRiskList();
                    break;
                case 'reduction':
                    loadEconomyActions();
                    loadInitiatives();
                    updateReductionStats();
                    break;
            }
            
            // Fermer le menu mobile
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        }

        // === GESTION DU STOCKAGE LOCAL ===
        function saveDataToStorage() {
            const data = {
                maintenanceRequests,
                riskReports,
                economyActions,
                consumptionData
            };
            localStorage.setItem('industrialSiteData', JSON.stringify(data));
        }

        function loadDataFromStorage() {
            const savedData = localStorage.getItem('industrialSiteData');
            if (savedData) {
                const data = JSON.parse(savedData);
                maintenanceRequests = data.maintenanceRequests || [];
                riskReports = data.riskReports || [];
                economyActions = data.economyActions || [];
                consumptionData = data.consumptionData || [];
            }
        }

        // === DONNÉES MOCK INITIALES ===
        function initializeMockData() {
            if (maintenanceRequests.length === 0) {
                maintenanceRequests = [
                    {
                        id: 1,
                        site: "Atelier A",
                        equipement: "Compresseur principal",
                        description: "Bruit anormal et vibrations excessives",
                        urgence: "haute",
                        statut: "ouvert",
                        date: "2024-01-15",
                        assignee: null,
                        timeline: [
                            { date: "2024-01-15", action: "Demande créée", user: "Jean Dupont" }
                        ]
                    },
                    {
                        id: 2,
                        site: "Entrepôt",
                        equipement: "Éclairage LED Zone B",
                        description: "Plusieurs luminaires défaillants",
                        urgence: "moyenne",
                        statut: "en-cours",
                        date: "2024-01-12",
                        assignee: "Marie Martin",
                        timeline: [
                            { date: "2024-01-12", action: "Demande créée", user: "Paul Durand" },
                            { date: "2024-01-13", action: "Assignée à Marie Martin", user: "Admin" },
                            { date: "2024-01-14", action: "Diagnostic effectué", user: "Marie Martin" }
                        ]
                    },
                    {
                        id: 3,
                        site: "Bureau",
                        equipement: "Climatisation",
                        description: "Maintenance préventive annuelle",
                        urgence: "basse",
                        statut: "resolu",
                        date: "2024-01-08",
                        assignee: "Pierre Leroy",
                        timeline: [
                            { date: "2024-01-08", action: "Demande créée", user: "Admin" },
                            { date: "2024-01-09", action: "Assignée à Pierre Leroy", user: "Admin" },
                            { date: "2024-01-10", action: "Intervention terminée", user: "Pierre Leroy" },
                            { date: "2024-01-11", action: "Demande résolue", user: "Admin" }
                        ]
                    }
                ];
            }

            if (riskReports.length === 0) {
                riskReports = [
                    {
                        id: 1,
                        lieu: "Zone de stockage chimique",
                        niveau: "haut",
                        description: "Fuite potentielle de produits chimiques",
                        actions: "Inspection immédiate et réparation des contenants",
                        date: "2024-01-14",
                        x: 20,
                        y: 30
                    },
                    {
                        id: 2,
                        lieu: "Escalier d'accès Atelier B",
                        niveau: "moyen",
                        description: "Rampe d'escalier desserrée",
                        actions: "Resserrage et vérification de la fixation",
                        date: "2024-01-12",
                        x: 60,
                        y: 50
                    },
                    {
                        id: 3,
                        lieu: "Parking visiteurs",
                        niveau: "bas",
                        description: "Éclairage insuffisant le soir",
                        actions: "Ajout de luminaires supplémentaires",
                        date: "2024-01-10",
                        x: 80,
                        y: 80
                    }
                ];
            }

            if (economyActions.length === 0) {
                economyActions = [
                    {
                        id: 1,
                        titre: "Optimisation éclairage LED",
                        description: "Remplacement de tous les éclairages par des LED haute efficacité",
                        impact: 15,
                        responsable: "Service Maintenance",
                        deadline: "2024-03-15",
                        statut: "en-cours",
                        completed: false
                    },
                    {
                        id: 2,
                        titre: "Isolation thermique bâtiments",
                        description: "Amélioration de l'isolation des ateliers pour réduire les besoins de chauffage",
                        impact: 25,
                        responsable: "Bureau d'études",
                        deadline: "2024-06-30",
                        statut: "planifie",
                        completed: false
                    },
                    {
                        id: 3,
                        titre: "Audit énergétique complet",
                        description: "Analyse détaillée de tous les postes de consommation",
                        impact: 5,
                        responsable: "Consultant externe",
                        deadline: "2024-02-28",
                        statut: "termine",
                        completed: true
                    }
                ];
            }

            if (consumptionData.length === 0) {
                consumptionData = [
                    { period: "Jan", consumption: 1200, cost: 2280 },
                    { period: "Fév", consumption: 1150, cost: 2185 },
                    { period: "Mar", consumption: 1300, cost: 2470 },
                    { period: "Avr", consumption: 1250, cost: 2375 },
                    { period: "Mai", consumption: 1180, cost: 2242 },
                    { period: "Jun", consumption: 1320, cost: 2508 },
                    { period: "Jul", consumption: 1400, cost: 2660 }
                ];
            }

            saveDataToStorage();
        }

        // === MAINTENANCE - GESTION DES DEMANDES ===
        function showMaintenanceForm() {
            document.getElementById('maintenance-form').classList.remove('hidden');
        }

        function hideMaintenanceForm() {
            document.getElementById('maintenance-form').classList.add('hidden');
            document.getElementById('maintenance-form').querySelector('form').reset();
        }

        function addMaintenanceRequest(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const newRequest = {
                id: Date.now(),
                site: document.getElementById('maintenance-site').value,
                equipement: document.getElementById('maintenance-equipement').value,
                description: document.getElementById('maintenance-description').value,
                urgence: document.getElementById('maintenance-urgence').value,
                statut: 'ouvert',
                date: new Date().toISOString().split('T')[0],
                assignee: null,
                timeline: [
                    { 
                        date: new Date().toISOString().split('T')[0], 
                        action: "Demande créée", 
                        user: "Utilisateur actuel" 
                    }
                ]
            };
            
            maintenanceRequests.unshift(newRequest);
            saveDataToStorage();
            loadMaintenanceKanban();
            hideMaintenanceForm();
            showNotification('Demande de maintenance créée avec succès', 'success');
        }

        function loadMaintenanceKanban() {
            const statuses = ['ouvert', 'en-cours', 'resolu'];
            
            statuses.forEach(status => {
                const container = document.getElementById(`kanban-${status}`);
                const requests = maintenanceRequests.filter(req => req.statut === status);
                
                container.innerHTML = '';
                
                requests.forEach(request => {
                    const card = createMaintenanceCard(request);
                    container.appendChild(card);
                });
                
                // Mettre à jour le compteur
                document.getElementById(`count-${status}`).textContent = requests.length;
            });
        }

        function createMaintenanceCard(request) {
            const card = document.createElement('div');
            card.className = `kanban-card priority-${request.urgence}`;
            card.onclick = () => showMaintenanceDetails(request.id);
            
            const urgenceColors = {
                'basse': 'bg-green-100 text-green-800',
                'moyenne': 'bg-yellow-100 text-yellow-800',
                'haute': 'bg-red-100 text-red-800'
            };
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <h4 class="font-semibold text-gray-900 text-sm">${request.equipement}</h4>
                    <span class="px-2 py-1 rounded-full text-xs font-medium ${urgenceColors[request.urgence]}">
                        ${request.urgence.charAt(0).toUpperCase() + request.urgence.slice(1)}
                    </span>
                </div>
                <p class="text-gray-600 text-sm mb-2">${request.site}</p>
                <p class="text-gray-700 text-sm mb-3 line-clamp-2">${request.description}</p>
                <div class="flex justify-between items-center text-xs text-gray-500">
                    <span>${new Date(request.date).toLocaleDateString('fr-FR')}</span>
                    ${request.assignee ? `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded">${request.assignee}</span>` : '<span class="text-gray-400">Non assigné</span>'}
                </div>
                <div class="mt-2 flex space-x-2">
                    ${request.statut !== 'resolu' ? `
                        <button onclick="event.stopPropagation(); changeMaintenanceStatus(${request.id})" class="text-blue-600 hover:text-blue-800 text-xs">
                            <i class="fas fa-edit mr-1"></i>Modifier
                        </button>
                    ` : ''}
                    <button onclick="event.stopPropagation(); deleteMaintenanceRequest(${request.id})" class="text-red-600 hover:text-red-800 text-xs">
                        <i class="fas fa-trash mr-1"></i>Supprimer
                    </button>
                </div>
            `;
            
            return card;
        }

        function showMaintenanceDetails(requestId) {
            const request = maintenanceRequests.find(req => req.id === requestId);
            if (!request) return;
            
            const modal = document.getElementById('maintenance-modal');
            const content = document.getElementById('maintenance-modal-content');
            
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Site/Zone</label>
                            <p class="text-gray-900">${request.site}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Équipement</label>
                            <p class="text-gray-900">${request.equipement}</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Description</label>
                        <p class="text-gray-900">${request.description}</p>
                    </div>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Urgence</label>
                            <p class="text-gray-900 capitalize">${request.urgence}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Statut</label>
                            <p class="text-gray-900 capitalize">${request.statut.replace('-', ' ')}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Assigné à</label>
                            <p class="text-gray-900">${request.assignee || 'Non assigné'}</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-semibold mb-3">Historique des actions</h4>
                        <div class="space-y-3">
                            ${request.timeline.map(item => `
                                <div class="timeline-item">
                                    <div class="timeline-dot"></div>
                                    <div class="bg-gray-50 p-3 rounded-lg">
                                        <div class="flex justify-between items-center">
                                            <span class="font-medium">${item.action}</span>
                                            <span class="text-sm text-gray-500">${new Date(item.date).toLocaleDateString('fr-FR')}</span>
                                        </div>
                                        <span class="text-sm text-gray-600">Par: ${item.user}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    ${request.statut !== 'resolu' ? `
                        <div class="flex space-x-4 pt-4 border-t">
                            <button onclick="assignMaintenance(${request.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                                <i class="fas fa-user-plus mr-2"></i>Assigner
                            </button>
                            <button onclick="changeMaintenanceStatus(${request.id})" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md">
                                <i class="fas fa-edit mr-2"></i>Changer statut
                            </button>
                            <button onclick="addMaintenanceComment(${request.id})" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-md">
                                <i class="fas fa-comment mr-2"></i>Commenter
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function closeMaintenanceModal() {
            document.getElementById('maintenance-modal').classList.add('hidden');
        }

        function changeMaintenanceStatus(requestId) {
            const request = maintenanceRequests.find(req => req.id === requestId);
            if (!request) return;
            
            const statuses = ['ouvert', 'en-cours', 'resolu'];
            const currentIndex = statuses.indexOf(request.statut);
            const nextStatus = statuses[(currentIndex + 1) % statuses.length];
            
            request.statut = nextStatus;
            request.timeline.push({
                date: new Date().toISOString().split('T')[0],
                action: `Statut changé vers: ${nextStatus.replace('-', ' ')}`,
                user: "Utilisateur actuel"
            });
            
            saveDataToStorage();
            loadMaintenanceKanban();
            closeMaintenanceModal();
            showNotification(`Statut changé vers: ${nextStatus.replace('-', ' ')}`, 'success');
        }

        function assignMaintenance(requestId) {
            const assignee = prompt("Nom de la personne à assigner:");
            if (!assignee) return;
            
            const request = maintenanceRequests.find(req => req.id === requestId);
            if (!request) return;
            
            request.assignee = assignee;
            request.timeline.push({
                date: new Date().toISOString().split('T')[0],
                action: `Assigné à: ${assignee}`,
                user: "Utilisateur actuel"
            });
            
            saveDataToStorage();
            loadMaintenanceKanban();
            closeMaintenanceModal();
            showNotification(`Demande assignée à ${assignee}`, 'success');
        }

        function addMaintenanceComment(requestId) {
            const comment = prompt("Ajouter un commentaire:");
            if (!comment) return;
            
            const request = maintenanceRequests.find(req => req.id === requestId);
            if (!request) return;
            
            request.timeline.push({
                date: new Date().toISOString().split('T')[0],
                action: `Commentaire: ${comment}`,
                user: "Utilisateur actuel"
            });
            
            saveDataToStorage();
            showMaintenanceDetails(requestId); // Rafraîchir la modal
            showNotification('Commentaire ajouté', 'success');
        }

        function deleteMaintenanceRequest(requestId) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer cette demande ?')) return;
            
            maintenanceRequests = maintenanceRequests.filter(req => req.id !== requestId);
            saveDataToStorage();
            loadMaintenanceKanban();
            closeMaintenanceModal();
            showNotification('Demande supprimée', 'success');
        }

        // === ÉNERGIE - DASHBOARD ET OPTIMISATION ===
        function loadEnergyDashboard() {
            drawConsumptionChart();
            loadOptimizationSuggestions();
            updateSavingsSimulation();
        }

        function drawConsumptionChart() {
            const canvas = document.getElementById('consumption-chart');
            const ctx = canvas.getContext('2d');
            
            // Effacer le canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const data = consumptionData.slice(-7); // 7 derniers mois
            const maxConsumption = Math.max(...data.map(d => d.consumption));
            const padding = 40;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            
            // Dessiner les axes
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            // Axe Y
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.stroke();
            
            // Axe X
            ctx.beginPath();
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // Dessiner les barres
            const barWidth = chartWidth / data.length * 0.8;
            const barSpacing = chartWidth / data.length * 0.2;
            
            data.forEach((item, index) => {
                const barHeight = (item.consumption / maxConsumption) * chartHeight;
                const x = padding + index * (barWidth + barSpacing) + barSpacing / 2;
                const y = canvas.height - padding - barHeight;
                
                // Gradient pour les barres
                const gradient = ctx.createLinearGradient(0, y, 0, canvas.height - padding);
                gradient.addColorStop(0, '#3b82f6');
                gradient.addColorStop(1, '#1d4ed8');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Labels
                ctx.fillStyle = '#374151';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.period, x + barWidth / 2, canvas.height - padding + 20);
                ctx.fillText(item.consumption + ' kWh', x + barWidth / 2, y - 10);
            });
        }

        function loadOptimizationSuggestions() {
            const suggestions = [
                {
                    title: "Décaler les plages horaires",
                    description: "Utiliser les heures creuses pour les gros équipements",
                    savings: "12%",
                    priority: "haute"
                },
                {
                    title: "Maintenance préventive",
                    description: "Entretien régulier des équipements pour optimiser leur rendement",
                    savings: "8%",
                    priority: "moyenne"
                },
                {
                    title: "Réglage des thermostats",
                    description: "Optimiser les températures selon les zones d'activité",
                    savings: "15%",
                    priority: "haute"
                },
                {
                    title: "Éclairage intelligent",
                    description: "Installation de capteurs de présence et de luminosité",
                    savings: "10%",
                    priority: "moyenne"
                }
            ];
            
            const container = document.getElementById('optimization-suggestions');
            container.innerHTML = '';
            
            suggestions.forEach(suggestion => {
                const div = document.createElement('div');
                div.className = 'p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow';
                
                const priorityColors = {
                    'haute': 'bg-red-100 text-red-800',
                    'moyenne': 'bg-yellow-100 text-yellow-800',
                    'basse': 'bg-green-100 text-green-800'
                };
                
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-gray-900">${suggestion.title}</h4>
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${priorityColors[suggestion.priority]}">
                            ${suggestion.priority}
                        </span>
                    </div>
                    <p class="text-gray-600 text-sm mb-2">${suggestion.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-green-600 font-semibold">Économie: ${suggestion.savings}</span>
                        <button onclick="applySuggestion('${suggestion.title}')" class="text-blue-600 hover:text-blue-800 text-sm">
                            <i class="fas fa-check mr-1"></i>Appliquer
                        </button>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function applySuggestion(title) {
            showNotification(`Suggestion "${title}" marquée pour application`, 'info');
        }

        function updateSavingsSimulation() {
            const slider = document.getElementById('savings-slider');
            const percentage = parseInt(slider.value);
            const currentCost = 2340; // Coût mensuel actuel
            
            const monthlySavings = Math.round(currentCost * percentage / 100);
            const yearlySavings = monthlySavings * 12;
            const kwhSaved = Math.round(1250 * percentage / 100);
            
            document.getElementById('slider-value').textContent = percentage + '%';
            document.getElementById('monthly-savings').textContent = '€' + monthlySavings;
            document.getElementById('yearly-savings').textContent = '€' + yearlySavings;
            document.getElementById('kwh-saved').textContent = kwhSaved + ' kWh';
        }

        // === RISQUES - GESTION DES LIEUX À RISQUES ===
        function showRiskForm() {
            document.getElementById('risk-form').classList.remove('hidden');
        }

        function hideRiskForm() {
            document.getElementById('risk-form').classList.add('hidden');
            document.getElementById('risk-form').querySelector('form').reset();
        }

        function addRiskReport(event) {
            event.preventDefault();
            
            const newRisk = {
                id: Date.now(),
                lieu: document.getElementById('risk-lieu').value,
                niveau: document.getElementById('risk-niveau').value,
                description: document.getElementById('risk-description').value,
                actions: document.getElementById('risk-actions').value,
                date: new Date().toISOString().split('T')[0],
                x: Math.random() * 80 + 10, // Position aléatoire sur la carte
                y: Math.random() * 80 + 10
            };
            
            riskReports.push(newRisk);
            saveDataToStorage();
            loadRiskMap();
            loadRiskList();
            hideRiskForm();
            showNotification('Signalement de risque créé avec succès', 'success');
        }

        function loadRiskMap() {
            const map = document.getElementById('risk-map');
            
            // Supprimer les anciens points
            const existingPoints = map.querySelectorAll('.risk-point');
            existingPoints.forEach(point => point.remove());
            
            riskReports.forEach(risk => {
                const point = document.createElement('div');
                point.className = `risk-point ${risk.niveau}`;
                point.style.left = risk.x + '%';
                point.style.top = risk.y + '%';
                point.textContent = risk.id;
                point.title = `${risk.lieu} - ${risk.niveau}`;
                point.onclick = () => showRiskDetails(risk.id);
                
                map.appendChild(point);
            });
        }

        function loadRiskList() {
            const container = document.getElementById('risk-list');
            container.innerHTML = '';
            
            const sortedRisks = [...riskReports].sort((a, b) => {
                const priorityOrder = { 'haut': 3, 'moyen': 2, 'bas': 1 };
                return priorityOrder[b.niveau] - priorityOrder[a.niveau];
            });
            
            sortedRisks.forEach(risk => {
                const div = document.createElement('div');
                div.className = `p-4 border-2 rounded-lg risk-${risk.niveau} cursor-pointer hover:shadow-md transition-shadow`;
                div.onclick = () => showRiskDetails(risk.id);
                
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-gray-900">${risk.lieu}</h4>
                        <span class="px-2 py-1 rounded-full text-xs font-medium bg-white">
                            ${risk.niveau.charAt(0).toUpperCase() + risk.niveau.slice(1)}
                        </span>
                    </div>
                    <p class="text-gray-700 text-sm mb-2">${risk.description}</p>
                    <p class="text-gray-600 text-xs mb-2"><strong>Actions:</strong> ${risk.actions}</p>
                    <div class="flex justify-between items-center text-xs text-gray-500">
                        <span>Signalé le ${new Date(risk.date).toLocaleDateString('fr-FR')}</span>
                        <button onclick="event.stopPropagation(); deleteRiskReport(${risk.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function showRiskDetails(riskId) {
            const risk = riskReports.find(r => r.id === riskId);
            if (!risk) return;
            
            alert(`Détails du risque:\n\nLieu: ${risk.lieu}\nNiveau: ${risk.niveau}\nDescription: ${risk.description}\nActions: ${risk.actions}\nDate: ${new Date(risk.date).toLocaleDateString('fr-FR')}`);
        }

        function deleteRiskReport(riskId) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer ce signalement ?')) return;
            
            riskReports = riskReports.filter(risk => risk.id !== riskId);
            saveDataToStorage();
            loadRiskMap();
            loadRiskList();
            showNotification('Signalement supprimé', 'success');
        }

        // === RÉDUCTION CONSOMMATION - ACTIONS ET INITIATIVES ===
        function showActionForm() {
            document.getElementById('action-form').classList.remove('hidden');
        }

        function hideActionForm() {
            document.getElementById('action-form').classList.add('hidden');
            document.getElementById('action-form').querySelector('form').reset();
        }

        function addEconomyAction(event) {
            event.preventDefault();
            
            const newAction = {
                id: Date.now(),
                titre: document.getElementById('action-titre').value,
                description: document.getElementById('action-description').value,
                impact: parseInt(document.getElementById('action-impact').value),
                responsable: document.getElementById('action-responsable').value,
                deadline: document.getElementById('action-deadline').value,
                statut: 'planifie',
                completed: false
            };
            
            economyActions.push(newAction);
            saveDataToStorage();
            loadEconomyActions();
            loadInitiatives();
            updateReductionStats();
            hideActionForm();
            showNotification('Action d\'économie ajoutée avec succès', 'success');
        }

        function loadEconomyActions() {
            const container = document.getElementById('actions-checklist');
            container.innerHTML = '';
            
            economyActions.forEach(action => {
                const div = document.createElement('div');
                div.className = 'flex items-center p-3 bg-gray-50 rounded-lg';
                
                const statusColors = {
                    'planifie': 'text-yellow-600',
                    'en-cours': 'text-blue-600',
                    'termine': 'text-green-600'
                };
                
                div.innerHTML = `
                    <input type="checkbox" ${action.completed ? 'checked' : ''} 
                           onchange="toggleActionCompletion(${action.id})" 
                           class="mr-3 h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <h4 class="font-medium text-gray-900 ${action.completed ? 'line-through' : ''}">${action.titre}</h4>
                            <span class="text-sm ${statusColors[action.statut]} font-medium">${action.statut}</span>
                        </div>
                        <p class="text-sm text-gray-600">${action.description}</p>
                        <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                            <span>Impact: ${action.impact}%</span>
                            <span>Échéance: ${new Date(action.deadline).toLocaleDateString('fr-FR')}</span>
                        </div>
                    </div>
                    <button onclick="deleteEconomyAction(${action.id})" class="ml-2 text-red-600 hover:text-red-800">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                container.appendChild(div);
            });
        }

        function loadInitiatives() {
            const container = document.getElementById('initiatives-list');
            container.innerHTML = '';
            
            const activeInitiatives = economyActions.filter(action => !action.completed);
            
            activeInitiatives.forEach(initiative => {
                const div = document.createElement('div');
                div.className = 'p-4 border border-gray-200 rounded-lg';
                
                const progressPercentage = initiative.statut === 'termine' ? 100 : 
                                         initiative.statut === 'en-cours' ? 60 : 20;
                
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-gray-900">${initiative.titre}</h4>
                        <span class="text-sm text-gray-600">${initiative.responsable}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                        <div class="bg-green-600 h-2 rounded-full transition-all duration-500" style="width: ${progressPercentage}%"></div>
                    </div>
                    <div class="flex justify-between items-center text-sm text-gray-600">
                        <span>Impact estimé: ${initiative.impact}%</span>
                        <span>Échéance: ${new Date(initiative.deadline).toLocaleDateString('fr-FR')}</span>
                    </div>
                    <div class="mt-2">
                        <button onclick="changeActionStatus(${initiative.id})" class="text-blue-600 hover:text-blue-800 text-sm">
                            <i class="fas fa-edit mr-1"></i>Changer statut
                        </button>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function toggleActionCompletion(actionId) {
            const action = economyActions.find(a => a.id === actionId);
            if (!action) return;
            
            action.completed = !action.completed;
            action.statut = action.completed ? 'termine' : 'planifie';
            
            saveDataToStorage();
            loadEconomyActions();
            loadInitiatives();
            updateReductionStats();
            showNotification(`Action ${action.completed ? 'complétée' : 'réactivée'}`, 'success');
        }

        function changeActionStatus(actionId) {
            const action = economyActions.find(a => a.id === actionId);
            if (!action) return;
            
            const statuses = ['planifie', 'en-cours', 'termine'];
            const currentIndex = statuses.indexOf(action.statut);
            const nextStatus = statuses[(currentIndex + 1) % statuses.length];
            
            action.statut = nextStatus;
            action.completed = nextStatus === 'termine';
            
            saveDataToStorage();
            loadEconomyActions();
            loadInitiatives();
            updateReductionStats();
            showNotification(`Statut changé vers: ${nextStatus}`, 'success');
        }

        function deleteEconomyAction(actionId) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer cette action ?')) return;
            
            economyActions = economyActions.filter(action => action.id !== actionId);
            saveDataToStorage();
            loadEconomyActions();
            loadInitiatives();
            updateReductionStats();
            showNotification('Action supprimée', 'success');
        }

        function updateReductionStats() {
            const totalActions = economyActions.length;
            const completedActions = economyActions.filter(a => a.completed).length;
            const totalImpact = economyActions.reduce((sum, action) => sum + action.impact, 0);
            
            document.getElementById('total-actions').textContent = totalActions;
            document.getElementById('completed-actions').textContent = completedActions;
            document.getElementById('total-impact').textContent = totalImpact + '%';
        }

        function exportReport() {
            const report = {
                date: new Date().toISOString(),
                maintenance: {
                    total: maintenanceRequests.length,
                    ouvert: maintenanceRequests.filter(r => r.statut === 'ouvert').length,
                    enCours: maintenanceRequests.filter(r => r.statut === 'en-cours').length,
                    resolu: maintenanceRequests.filter(r => r.statut === 'resolu').length
                },
                risques: {
                    total: riskReports.length,
                    haut: riskReports.filter(r => r.niveau === 'haut').length,
                    moyen: riskReports.filter(r => r.niveau === 'moyen').length,
                    bas: riskReports.filter(r => r.niveau === 'bas').length
                },
                economie: {
                    totalActions: economyActions.length,
                    actionsCompletes: economyActions.filter(a => a.completed).length,
                    impactTotal: economyActions.reduce((sum, action) => sum + action.impact, 0)
                },
                consommation: consumptionData
            };
            
            const dataStr = JSON.stringify(report, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `rapport-site-industriel-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Rapport exporté avec succès', 'success');
        }

        // === UTILITAIRES ===
        function updateAllCounters() {
            // Mettre à jour tous les compteurs de l'application
            if (currentPage === 'maintenance') {
                loadMaintenanceKanban();
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : type === 'warning' ? 'exclamation' : 'info'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.getElementById('notification-area').appendChild(notification);
            
            // Afficher la notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Masquer et supprimer la notification après 3 secondes
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Fermer les modals en cliquant à l'extérieur
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('maintenance-modal');
            if (modal && event.target === modal) {
                closeMaintenanceModal();
            }
        });

        // Fermer les modals avec la touche Échap
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeMaintenanceModal();
            }
        });
    </script>
</body>
</html>