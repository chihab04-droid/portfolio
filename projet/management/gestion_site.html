<!-- gestion_site.html -->
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gestion Site - Maintenance & Énergie</title>

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4f46e5',       // bleu inspiré PNG
            secondary: '#14b8a6',     // teal
            accent: '#f59e0b',        // orange pour alertes
            danger: '#ef4444',        // rouge
            bgcard: '#f9fafb'
          },
          fontFamily: { 
            sans: ['Inter', 'ui-sans-serif', 'system-ui'] 
          }
        }
      }
    }
  </script>

  <!-- Styles complémentaires -->
  <style>
    /* Animation fade-in */
    .fade-enter { opacity: 0; transform: translateY(12px); }
    .fade-enter-active { opacity: 1; transform: translateY(0); transition: all .4s ease; }

    /* Hover cards effect */
    .card:hover { transform: translateY(-3px); box-shadow: 0 12px 24px rgba(0,0,0,0.12); transition: all 0.3s ease; }

    /* Plan simplified cells */
    .risk-cell { min-height: 80px; display:flex; align-items:center; justify-content:center; border-radius:0.5rem; font-weight:500; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans antialiased">

<div id="app" class="min-h-screen flex flex-col">

  <!-- Header / Navbar -->
  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-4">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-full bg-gradient-to-tr from-primary to-secondary flex items-center justify-center text-white font-bold text-xl shadow-lg">GS</div>
          <div>
            <h1 class="text-xl font-semibold tracking-wide">Gestion Site</h1>
            <p class="text-xs text-gray-500">Maintenance • Énergie • Risques • Conso</p>
          </div>
        </div>

        <!-- Desktop menu -->
        <nav class="hidden md:flex items-center gap-6 font-medium text-gray-700" role="navigation" aria-label="Main navigation">
          <a href="#maintenance" class="nav-link hover:text-primary transition" data-route="maintenance">Maintenance</a>
          <a href="#energie" class="nav-link hover:text-primary transition" data-route="energie">Énergie</a>
          <a href="#risques" class="nav-link hover:text-primary transition" data-route="risques">Lieux à risques</a>
          <a href="#reduction" class="nav-link hover:text-primary transition" data-route="reduction">Réduction conso</a>
        </nav>

        <!-- Mobile burger -->
        <div class="md:hidden">
          <button id="burgerBtn" aria-label="Ouvrir le menu" class="p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary">
            <svg id="burgerIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile menu panel -->
    <div id="mobileMenu" class="md:hidden hidden border-t bg-white shadow">
      <div class="px-4 pt-4 pb-6 space-y-1 font-medium">
        <a href="#maintenance" class="block py-2 nav-link-mobile" data-route="maintenance">Maintenance</a>
        <a href="#energie" class="block py-2 nav-link-mobile" data-route="energie">Énergie</a>
        <a href="#risques" class="block py-2 nav-link-mobile" data-route="risques">Lieux à risques</a>
        <a href="#reduction" class="block py-2 nav-link-mobile" data-route="reduction">Réduction conso</a>
      </div>
    </div>
  </header>

  <!-- Main content -->
  <main class="flex-1 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-6">
    <div id="sectionHeader">
      <h2 id="pageTitle" class="text-2xl font-bold tracking-wide">Tableau de bord</h2>
      <p id="pageSubtitle" class="text-sm text-gray-500">Vue synthétique</p>
    </div>
    <div id="content" class="space-y-6"></div>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 text-sm text-gray-500 flex justify-between">
      <div>© <span id="year"></span> Gestion Site</div>
      <div>Design inspiré par l'image jointe • Client-side demo</div>
    </div>
  </footer>
</div>

<!-- ---------------------------
     JavaScript application (SPA + localStorage)
---------------------------->
<script>
/* --------- Utilities --------- */
const STORE_KEY='gestion_site_data_v2';
const uid=()=> 'id-'+Math.random().toString(36).slice(2,9);
const escapeHtml=str=>String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
const formatDateInput=d=>new Date(d||Date.now()).toISOString().slice(0,10);

let dataStore = JSON.parse(localStorage.getItem(STORE_KEY)||'null') || {
  maintenanceRequests: [],
  energy: { consumptionSeries: [], suggestions: [] },
  risks: [],
  initiatives: []
};
const saveData=()=>localStorage.setItem(STORE_KEY, JSON.stringify(dataStore));

/* --------- Routes SPA --------- */
const routes = {
  'maintenance': { title:'Maintenance', subtitle:'Créer et suivre les demandes', render: renderMaintenance },
  'energie': { title:'Énergie', subtitle:'Dashboard de consommation', render: renderEnergie },
  'risques': { title:'Lieux à risques', subtitle:'Signaler et suivre', render: renderRisques },
  'reduction': { title:'Réduction conso', subtitle:'Initiatives et actions', render: renderReduction }
};

function setActiveNav(route){
  document.querySelectorAll('.nav-link').forEach(a=>a.classList.toggle('text-primary font-semibold', a.dataset.route===route));
  document.querySelectorAll('.nav-link-mobile').forEach(a=>a.classList.toggle('text-primary font-semibold', a.dataset.route===route));
}

function renderRoute(hash){
  const route = hash||'maintenance';
  const meta = routes[route];
  if(!meta) return;
  document.getElementById('pageTitle').textContent=meta.title;
  document.getElementById('pageSubtitle').textContent=meta.subtitle;
  setActiveNav(route);
  const content=document.getElementById('content'); content.innerHTML='';
  const section=meta.render(); section.classList.add('fade-enter');
  content.appendChild(section); requestAnimationFrame(()=>section.classList.add('fade-enter-active'));
}

/* --------- Mobile menu toggle --------- */
const burgerBtn=document.getElementById('burgerBtn');
const mobileMenu=document.getElementById('mobileMenu');
burgerBtn.addEventListener('click',()=>mobileMenu.classList.toggle('hidden'));
document.querySelectorAll('.nav-link-mobile').forEach(a=>a.addEventListener('click',()=>mobileMenu.classList.add('hidden')));
document.querySelectorAll('.nav-link').forEach(a=>a.addEventListener('click',e=>{ e.preventDefault(); location.hash=a.dataset.route; }));

window.addEventListener('hashchange',()=>renderRoute(location.hash.replace('#','')));
document.getElementById('year').textContent=new Date().getFullYear();
renderRoute(location.hash.replace('#','')||'maintenance');

/* --------- Render functions --------- */
function renderMaintenance(){
  const container=document.createElement('div'); container.className='space-y-6';
  // Card design
  const formCard=document.createElement('div'); formCard.className='bg-bgcard p-5 rounded-xl shadow-lg card';
  formCard.innerHTML=`<h3 class="text-lg font-semibold mb-3">Créer demande</h3>
    <form class="grid gap-3 sm:grid-cols-2" id="maintenanceForm">
      <input name="site" placeholder="Site" class="p-2 rounded border-gray-300 col-span-1"/>
      <input name="equipment" placeholder="Équipement" class="p-2 rounded border-gray-300 col-span-1"/>
      <textarea name="desc" placeholder="Description" class="p-2 rounded border-gray-300 col-span-2"></textarea>
      <select name="urgency" class="p-2 rounded border-gray-300 col-span-1">
        <option>Faible</option><option>Moyenne</option><option selected>Haute</option>
      </select>
      <button class="col-span-1 bg-primary text-white p-2 rounded shadow hover:bg-primary/80 transition">Créer</button>
    </form>`;
  container.appendChild(formCard);

  const listCard=document.createElement('div'); listCard.className='grid sm:grid-cols-2 lg:grid-cols-3 gap-4';
  dataStore.maintenanceRequests.forEach(r=>{
    const card=document.createElement('div'); card.className='bg-white rounded-xl p-4 shadow card flex flex-col justify-between';
    card.innerHTML=`<div class="font-bold text-primary">${r.equipment}</div><div class="text-sm text-gray-500">${r.site}</div>
      <p class="mt-2 text-gray-700">${escapeHtml(r.desc)}</p>
      <div class="mt-3 flex justify-between text-xs text-gray-600">
        <span>Status: ${r.status}</span>
        <div class="flex gap-1">
          <button class="px-2 py-1 rounded border btn-next">Suivant</button>
          <button class="px-2 py-1 rounded border btn-delete text-danger">Suppr</button>
        </div>
      </div>`;
    card.querySelector('.btn-delete').addEventListener('click',()=>{ dataStore.maintenanceRequests=dataStore.maintenanceRequests.filter(x=>x.id!==r.id); saveData(); renderRoute('maintenance'); });
    card.querySelector('.btn-next').addEventListener('click',()=>{ r.status=r.status==='ouvert'?'en cours':'resolu'; saveData(); renderRoute('maintenance'); });
    listCard.appendChild(card);
  });
  container.appendChild(listCard);

  document.getElementById('maintenanceForm').addEventListener('submit',e=>{
    e.preventDefault();
    const f=Object.fromEntries(new FormData(e.target).entries());
    dataStore.maintenanceRequests.unshift({id:uid(), site:f.site, equipment:f.equipment, desc:f.desc, urgency:f.urgency, status:'ouvert'});
    saveData(); renderRoute('maintenance'); e.target.reset();
  });

  return container;
}

function renderEnergie(){
  const c=document.createElement('div'); c.className='grid gap-6';
  c.innerHTML=`<div class="bg-gradient-to-r from-primary to-secondary p-6 rounded-xl shadow-lg card">
      <h3 class="text-lg font-bold text-white mb-2">Consommation énergétique</h3>
      <p class="text-white/80">Vue synthétique des derniers relevés.</p>
    </div>
    <div class="bg-white p-6 rounded-xl shadow-lg card">
      <h3 class="text-lg font-bold mb-2">Suggestions d'économie</h3>
      <ul class="list-disc pl-5 text-gray-700">
        ${dataStore.energy.suggestions.map(s=>`<li>${escapeHtml(s)}</li>`).join('')}
      </ul>
    </div>`;
  return c;
}

function renderRisques(){
  const c=document.createElement('div'); c.className='grid sm:grid-cols-2 gap-4';
  dataStore.risks.forEach(r=>{
    const card=document.createElement('div'); card.className='bg-red-50 p-4 rounded-xl shadow-lg card';
    card.innerHTML=`<h4 class="font-semibold text-red-600">${escapeHtml(r.name)}</h4>
      <p class="text-sm text-gray-600">${escapeHtml(r.desc)}</p>`;
    c.appendChild(card);
  });
  return c;
}

function renderReduction(){
  const c=document.createElement('div'); c.className='grid sm:grid-cols-2 gap-4';
  dataStore.initiatives.forEach(r=>{
    const card=document.createElement('div'); card.className='bg-green-50 p-4 rounded-xl shadow-lg card'>
      <h4 class="font-semibold text-green-700">${escapeHtml(r.name)}</h4>
      <p class="text-sm text-gray-600">${escapeHtml(r.desc)}</p>
    </div>`;
    c.appendChild(card);
  });
  return c;
}
</script>
</body>
</html>
